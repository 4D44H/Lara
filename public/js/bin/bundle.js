///<reference path="_references.ts"/>
$("#button-create-survey").click(function () {
    var errors = new Array();
    if ($("#description").val().length > 1500) {
        errors.push("Der Beschreibungstext ist zu lange! Der Text sollte weniger als 1500 Zeichen enthalten.");
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});

///<reference path="_references.ts"/>
function getRowName(a) {
    return $(a).children("td").eq(0).text();
}
function getRowShifts(a) {
    return $(a).children("td").eq(1).text();
}
//inspired by http://stackoverflow.com/questions/3160277/jquery-table-sort
$(".fa-sort").click(function () {
    var isAscending = $(this).hasClass('fa-sort-asc');
    var rowCatcher = $(this).parent().data('sort') === 'name' ? getRowName : getRowShifts;
    var $table = $(this).parents("table");
    var rows = $table
        .find("tbody")
        .find("tr")
        .toArray()
        .sort(function (a, b) { return rowCatcher(a).localeCompare(rowCatcher(b), undefined, { 'numeric': true }); });
    if (!isAscending) {
        rows.reverse();
    }
    rows.forEach(function (row) { return $table.append($(row)); });
    $(this).parents('table').find('.fa-sort').removeClass('fa-sort-asc').removeClass('fa-sort-desc');
    $(this).addClass(isAscending ? 'fa-sort-desc' : 'fa-sort-asc');
});

///<reference path="_references.ts"/>
var Club;
(function (Club) {
    Club[Club["None"] = 0] = "None";
    Club[Club["BcClub"] = 2] = "BcClub";
    Club[Club["BcCafe"] = 3] = "BcCafe";
    Club[Club["BdClub"] = 4] = "BdClub";
    Club[Club["BhClub"] = 5] = "BhClub";
    Club[Club["BiClub"] = 6] = "BiClub";
})(Club || (Club = {}));
function getIdOfClub(club) {
    switch (club) {
        case "bc-Club":
            return Club.BcClub;
        case "bc-Caf√©":
            return Club.BcCafe;
    }
    return Club.None;
}
function showErrorModal(message) {
    $("#errorModal").modal("show");
    $("#errorModal").find(".modal-body").html(message);
}

// external references go here
///<reference path="../typings/index.d.ts"/>
// internal reference go here
///<reference path="CreateEditEvent.ts"/>
///<reference path="CreateSurvey.ts"/>
///<reference path="StatisticsView.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="_references.ts"/>
// values of events that should trigger the selection of all clubs
var internalEventValues = [
    "1",
    "4",
    "5",
    "6",
    "9" // other
];
$("#button-create-submit").add("#button-edit-submit").click(function () {
    var errors = new Array();
    var beginDate = new Date($("[name='beginDate']").prop("value") + " " + $("[name='beginTime']").prop("value"));
    var endDate = new Date($("[name='endDate']").prop("value") + " " + $("[name='endTime']").prop("value"));
    if (beginDate.getTime() > endDate.getTime()) {
        errors.push("Die Startzeit liegt vor der Endzeit!");
    }
    if ($("#filter-checkboxes").find("input[type=checkbox]:checked").length === 0) {
        errors.push("Den Filter vergessen! Bitte setze mindestens eine Sektion, der diese Veranstaltung/Aufgabe gezeigt werden soll.");
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});
$(function () {
    // if set, internal events will trigger selection of all clubs
    // if user sets the club manually, we want to keep his selection
    var autoSelectAllClubs = true;
    var allClubCheckBoxes = $("#filter").find("input[type=checkbox]");
    allClubCheckBoxes.click(function () {
        autoSelectAllClubs = false;
    });
    // important to use function() (anonymous function) here an not an arrow function
    // using an arrow function will change the "this" inside
    $("[name='evnt_type']").click(function () {
        var prop = $(this).val();
        var isInternalEvent = internalEventValues.indexOf(prop) !== -1;
        if (isInternalEvent) {
            if (autoSelectAllClubs) {
                $("#filter").find("input[type=checkbox]").prop("checked", true);
            }
        }
        else {
            // reset all checkboxes
            $("#filter").find("input[type=checkbox]").prop("checked", false);
            var clubName = $(document).find("#place").val();
            var clubId = getIdOfClub(clubName);
            if (clubId !== -1) {
                var showToClubCheckbox = $(document).find("[name=filterShowToClub" + clubId + "]");
                showToClubCheckbox.prop("checked", true);
            }
        }
    });
});

///<reference path="../typings/index.d.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="../typings/index.d.ts"/>
var Question = (function () {
    function Question(element) {
        this.questionDiv = $(element).closest('[name^=question]');
    }
    return Question;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZVN1cnZleS50cyIsIlN0YXRpc3RpY3NWaWV3LnRzIiwiVXRpbGl0aWVzLnRzIiwiX3JlZmVyZW5jZXMudHMiLCJDcmVhdGVFZGl0RXZlbnQudHMiLCJFdmVudFZpZXcudHMiLCJRdWVzdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7SUFDakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sR0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMseUZBQXlGLENBQUMsQ0FBQztJQUMzRyxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUssR0FBRyxHQUFHLEdBQUcsTUFBTSxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7O0FDWEgscUNBQXFDO0FBRXJDLG9CQUFvQixDQUFTO0lBQ3pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QyxDQUFDO0FBRUQsc0JBQXNCLENBQVM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMs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QVEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2hELElBQUksTUFBTSxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNoQixJQUFJLGtCQUFrQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDO2dCQUNuRixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzdDLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQzs7QUMzREgsNENBQTRDO0FBQzVDLG1DQUFtQzs7QUNEbkMsNENBQTRDO0FBRTVDO0lBSUksa0JBQVksT0FBZTtRQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQ0wsZUFBQztBQUFELENBUEEsQUFPQyxJQUFBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5cclxuJChcIiNidXR0b24tY3JlYXRlLXN1cnZleVwiKS5jbGljaygoKSA9PiB7XHJcbiAgICBsZXQgZXJyb3JzID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuICAgIGlmICgkKFwiI2Rlc2NyaXB0aW9uXCIpLnZhbCgpLmxlbmd0aCAgPiAxNTAwKSB7XHJcbiAgICAgICAgZXJyb3JzLnB1c2goXCJEZXIgQmVzY2hyZWlidW5nc3RleHQgaXN0IHp1IGxhbmdlISBEZXIgVGV4dCBzb2xsdGUgd2VuaWdlciBhbHMgMTUwMCBaZWljaGVuIGVudGhhbHRlbi5cIik7XHJcbiAgICB9XHJcbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBib290Ym94LmFsZXJ0KGVycm9ycy5tYXAoZXJyID0+IFwiPHA+XCIgKyBlcnIgKyBcIjwvcD5cIikuam9pbihcIlxcblwiKSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJfcmVmZXJlbmNlcy50c1wiLz5cclxuXHJcbmZ1bmN0aW9uIGdldFJvd05hbWUoYTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gJChhKS5jaGlsZHJlbihcInRkXCIpLmVxKDApLnRleHQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Um93U2hpZnRzKGE6IHN0cmluZykge1xyXG4gICAgcmV0dXJuICQoYSkuY2hpbGRyZW4oXCJ0ZFwiKS5lcSgxKS50ZXh0KCk7XHJcbn1cclxuXHJcbi8vaW5zcGlyZWQgYnkgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMTYwMjc3L2pxdWVyeS10YWJsZS1zb3J0XHJcbiQoXCIuZmEtc29ydFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgaXNBc2NlbmRpbmcgPSAkKHRoaXMpLmhhc0NsYXNzKCdmYS1zb3J0LWFzYycpO1xyXG4gICAgbGV0IHJvd0NhdGNoZXIgPSAkKHRoaXMpLnBhcmVudCgpLmRhdGEoJ3NvcnQnKSA9PT0gJ25hbWUnID8gZ2V0Um93TmFtZSA6IGdldFJvd1NoaWZ0cztcclxuICAgIGxldCAkdGFibGUgPSAkKHRoaXMpLnBhcmVudHMoXCJ0YWJsZVwiKTtcclxuICAgIGxldCByb3dzID0gJHRhYmxlXHJcbiAgICAgICAgLmZpbmQoXCJ0Ym9keVwiKVxyXG4gICAgICAgIC5maW5kKFwidHJcIilcclxuICAgICAgICAudG9BcnJheSgpXHJcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IHJvd0NhdGNoZXIoYSkubG9jYWxlQ29tcGFyZShyb3dDYXRjaGVyKGIpLCB1bmRlZmluZWQsIHsnbnVtZXJpYyc6IHRydWV9KSk7XHJcbiAgICBpZiAoIWlzQXNjZW5kaW5nKSB7XHJcbiAgICAgICAgcm93cy5yZXZlcnNlKCk7XHJcbiAgICB9XHJcbiAgICByb3dzLmZvckVhY2gocm93ID0+ICR0YWJsZS5hcHBlbmQoJChyb3cpKSk7XHJcbiAgICAkKHRoaXMpLnBhcmVudHMoJ3RhYmxlJykuZmluZCgnLmZhLXNvcnQnKS5yZW1vdmVDbGFzcygnZmEtc29ydC1hc2MnKS5yZW1vdmVDbGFzcygnZmEtc29ydC1kZXNjJyk7XHJcbiAgICAkKHRoaXMpLmFkZENsYXNzKGlzQXNjZW5kaW5nID8gJ2ZhLXNvcnQtZGVzYycgOiAnZmEtc29ydC1hc2MnKTtcclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5lbnVtIENsdWIge1xyXG4gICAgTm9uZSxcclxuICAgIEJjQ2x1YiA9IDIsXHJcbiAgICBCY0NhZmUsXHJcbiAgICBCZENsdWIsXHJcbiAgICBCaENsdWIsXHJcbiAgICBCaUNsdWJcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SWRPZkNsdWIgKGNsdWI6IHN0cmluZyk6IENsdWIge1xyXG4gICAgc3dpdGNoIChjbHViKSB7XHJcbiAgICAgICAgY2FzZSBcImJjLUNsdWJcIjpcclxuICAgICAgICAgICAgcmV0dXJuIENsdWIuQmNDbHViO1xyXG4gICAgICAgIGNhc2UgXCJiYy1DYWbDqVwiOlxyXG4gICAgICAgICAgICByZXR1cm4gQ2x1Yi5CY0NhZmU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQ2x1Yi5Ob25lO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzaG93RXJyb3JNb2RhbChtZXNzYWdlOiBzdHJpbmcpIHtcclxuICAgICQoXCIjZXJyb3JNb2RhbFwiKS5tb2RhbChcInNob3dcIik7XHJcbiAgICAkKFwiI2Vycm9yTW9kYWxcIikuZmluZChcIi5tb2RhbC1ib2R5XCIpLmh0bWwobWVzc2FnZSk7XHJcbn1cclxuIiwiLy8gZXh0ZXJuYWwgcmVmZXJlbmNlcyBnbyBoZXJlXHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbi8vIGludGVybmFsIHJlZmVyZW5jZSBnbyBoZXJlXHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIkNyZWF0ZUVkaXRFdmVudC50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiQ3JlYXRlU3VydmV5LnRzXCIvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJTdGF0aXN0aWNzVmlldy50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiVXRpbGl0aWVzLnRzXCIvPlxyXG5cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XHJcblxyXG4vLyB2YWx1ZXMgb2YgZXZlbnRzIHRoYXQgc2hvdWxkIHRyaWdnZXIgdGhlIHNlbGVjdGlvbiBvZiBhbGwgY2x1YnNcclxubGV0IGludGVybmFsRXZlbnRWYWx1ZXMgPSBbXHJcbiAgICBcIjFcIiwgLy8gSW5mb1xyXG4gICAgXCI0XCIsIC8vIEludGVybmFsIGV2ZW50XHJcbiAgICBcIjVcIiwgLy8gcHJpdmF0ZSBwYXJ0eVxyXG4gICAgXCI2XCIsIC8vIGNsZWFuaW5nXHJcbiAgICBcIjlcIiAgLy8gb3RoZXJcclxuXTtcclxuXHJcbiQoXCIjYnV0dG9uLWNyZWF0ZS1zdWJtaXRcIikuYWRkKFwiI2J1dHRvbi1lZGl0LXN1Ym1pdFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgZXJyb3JzID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuXHJcbiAgICBsZXQgYmVnaW5EYXRlID0gbmV3IERhdGUoJChcIltuYW1lPSdiZWdpbkRhdGUnXVwiKS5wcm9wKFwidmFsdWVcIikgKyBcIiBcIiArICQoXCJbbmFtZT0nYmVnaW5UaW1lJ11cIikucHJvcChcInZhbHVlXCIpKTtcclxuICAgIGxldCBlbmREYXRlID0gbmV3IERhdGUoJChcIltuYW1lPSdlbmREYXRlJ11cIikucHJvcChcInZhbHVlXCIpICsgXCIgXCIgKyAkKFwiW25hbWU9J2VuZFRpbWUnXVwiKS5wcm9wKFwidmFsdWVcIikpO1xyXG4gICAgaWYgKGJlZ2luRGF0ZS5nZXRUaW1lKCkgPiBlbmREYXRlLmdldFRpbWUoKSkge1xyXG4gICAgICAgIGVycm9ycy5wdXNoKFwiRGllIFN0YXJ0emVpdCBsaWVndCB2b3IgZGVyIEVuZHplaXQhXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKCQoXCIjZmlsdGVyLWNoZWNrYm94ZXNcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdOmNoZWNrZWRcIikubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgZXJyb3JzLnB1c2goXCJEZW4gRmlsdGVyIHZlcmdlc3NlbiEgQml0dGUgc2V0emUgbWluZGVzdGVucyBlaW5lIFNla3Rpb24sIGRlciBkaWVzZSBWZXJhbnN0YWx0dW5nL0F1ZmdhYmUgZ2V6ZWlndCB3ZXJkZW4gc29sbC5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYm9vdGJveC5hbGVydChlcnJvcnMubWFwKGVyciA9PiBcIjxwPlwiICsgZXJyICsgXCI8L3A+XCIpLmpvaW4oXCJcXG5cIikpXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59KTtcclxuJCgoKSA9PiB7XHJcbiAgICAvLyBpZiBzZXQsIGludGVybmFsIGV2ZW50cyB3aWxsIHRyaWdnZXIgc2VsZWN0aW9uIG9mIGFsbCBjbHVic1xyXG4gICAgLy8gaWYgdXNlciBzZXRzIHRoZSBjbHViIG1hbnVhbGx5LCB3ZSB3YW50IHRvIGtlZXAgaGlzIHNlbGVjdGlvblxyXG4gICAgbGV0IGF1dG9TZWxlY3RBbGxDbHVicyA9IHRydWU7XHJcbiAgICBsZXQgYWxsQ2x1YkNoZWNrQm94ZXMgPSAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIik7XHJcbiAgICBhbGxDbHViQ2hlY2tCb3hlcy5jbGljaygoKSA9PiB7XHJcbiAgICAgICAgYXV0b1NlbGVjdEFsbENsdWJzID0gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBpbXBvcnRhbnQgdG8gdXNlIGZ1bmN0aW9uKCkgKGFub255bW91cyBmdW5jdGlvbikgaGVyZSBhbiBub3QgYW4gYXJyb3cgZnVuY3Rpb25cclxuICAgIC8vIHVzaW5nIGFuIGFycm93IGZ1bmN0aW9uIHdpbGwgY2hhbmdlIHRoZSBcInRoaXNcIiBpbnNpZGVcclxuICAgICQoXCJbbmFtZT0nZXZudF90eXBlJ11cIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCBwcm9wID0gJCh0aGlzKS52YWwoKTtcclxuICAgICAgICBsZXQgaXNJbnRlcm5hbEV2ZW50ID0gaW50ZXJuYWxFdmVudFZhbHVlcy5pbmRleE9mKHByb3ApICE9PSAtMTtcclxuICAgICAgICBpZiAoaXNJbnRlcm5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChhdXRvU2VsZWN0QWxsQ2x1YnMpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjZmlsdGVyXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKS5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gcmVzZXQgYWxsIGNoZWNrYm94ZXNcclxuICAgICAgICAgICAgJChcIiNmaWx0ZXJcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpLnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKTtcclxuICAgICAgICAgICAgbGV0IGNsdWJOYW1lID0gJChkb2N1bWVudCkuZmluZChcIiNwbGFjZVwiKS52YWwoKTtcclxuICAgICAgICAgICAgbGV0IGNsdWJJZCA9IGdldElkT2ZDbHViKGNsdWJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjbHViSWQgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2hvd1RvQ2x1YkNoZWNrYm94ID0gJChkb2N1bWVudCkuZmluZChcIltuYW1lPWZpbHRlclNob3dUb0NsdWJcIiArIGNsdWJJZCArIFwiXVwiKTtcclxuICAgICAgICAgICAgICAgIHNob3dUb0NsdWJDaGVja2JveC5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiVXRpbGl0aWVzLnRzXCIvPlxyXG5cclxuXHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbmNsYXNzIFF1ZXN0aW9uIHtcclxuXHJcbiAgICBwcml2YXRlIHF1ZXN0aW9uRGl2OiBKUXVlcnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZWxlbWVudDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5xdWVzdGlvbkRpdiA9ICQoZWxlbWVudCkuY2xvc2VzdCgnW25hbWVePXF1ZXN0aW9uXScpO1xyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
