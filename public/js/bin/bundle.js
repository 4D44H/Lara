///<reference path="_references.ts"/>
$("#button-create-survey").click(function () {
    var errors = new Array();
    if ($("#description").val().length > 1500) {
        errors.push(translate("descriptionTooLong"));
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});

///<reference path="_references.ts"/>
function getRowName(a) {
    return $(a).children("td").eq(0).text();
}
function getRowShifts(a) {
    return $(a).children("td").eq(1).text();
}
//inspired by http://stackoverflow.com/questions/3160277/jquery-table-sort
function sortLeaderboards(sortIcon) {
    var isAscending = sortIcon.hasClass('fa-sort-asc');
    var rowCatcher = sortIcon.parent().data('sort') === 'name' ? getRowName : getRowShifts;
    var $table = sortIcon.parents("table");
    var rows = $table
        .find("tbody")
        .find("tr")
        .toArray()
        .sort(function (a, b) { return rowCatcher(a).localeCompare(rowCatcher(b), undefined, { 'numeric': true }); });
    if (!isAscending) {
        rows.reverse();
    }
    rows.forEach(function (row) { return $table.append($(row)); });
    sortIcon.parents('table')
        .find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .removeClass('fa-sort-asc')
        .removeClass('fa-sort-desc')
        .addClass('fa-sort');
    sortIcon.removeClass('fa-sort')
        .addClass(isAscending ? 'fa-sort-desc' : 'fa-sort-asc');
}
$(".fa-sort, .fa-sort-desc, .fa-sort-asc").click(function () {
    sortLeaderboards(this);
});
$('#leaderboardsTabs').find('thead').find('td').click(function () {
    sortLeaderboards($($(this).find('i').first()));
});
$(".statisticClubPicker").find("a").click(function () {
    var clubName = $(this).text().trim();
    localStorage.setItem('preferredStatistics', clubName);
});
$(function () {
    var preference = localStorage.getItem('preferredStatistics');
    if (preference) {
        $('.statisticClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preference;
        })
            .first()
            .click();
    }
});

///<reference path="_references.ts"/>
var Club;
(function (Club) {
    Club[Club["None"] = 0] = "None";
    Club[Club["BcClub"] = 2] = "BcClub";
    Club[Club["BcCafe"] = 3] = "BcCafe";
    Club[Club["BdClub"] = 4] = "BdClub";
    Club[Club["BhClub"] = 5] = "BhClub";
    Club[Club["BiClub"] = 6] = "BiClub";
})(Club || (Club = {}));
function getIdOfClub(club) {
    switch (club) {
        case "bc-Club":
            return Club.BcClub;
        case "bc-Caf√©":
            return Club.BcCafe;
    }
    return Club.None;
}
function showErrorModal(message) {
    $("#errorModal").modal("show");
    $("#errorModal").find(".modal-body").html(message);
}

// external references go here
///<reference path="../typings/index.d.ts"/>
///<reference path="CreateEditEvent.ts"/>
///<reference path="CreateSurvey.ts"/>
///<reference path="StatisticsView.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="_references.ts"/>
// values of events that should trigger the selection of all clubs
var internalEventValues = [
    "1",
    "4",
    "5",
    "6",
    "9" // other
];
$("#button-create-submit").add("#button-edit-submit").click(function () {
    var beginDate = new Date($("[name='beginDate']").prop("value") + " " + $("[name='beginTime']").prop("value"));
    var endDate = new Date($("[name='endDate']").prop("value") + " " + $("[name='endTime']").prop("value"));
    // contains the keys to translations to be shown if the condition is fulfilled
    var errorConditions = {
        'endBeforeStart': beginDate.getTime() > endDate.getTime(),
        'forgotFilter': $("#filter-checkboxes").find("input[type=checkbox]:checked").length === 0,
        'forgotPreparation': $('[name="preparationTime"]').val() === "",
        'forgotStartTime': $('[name="beginTime"]').val() === "",
        'forgotEndTime': $('[name="endTime"]').val() === ""
    };
    var errors = Object.keys(errorConditions)
        .filter(function (key) { return errorConditions[key]; })
        .map(function (key) { return translate(key); });
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});
$(function () {
    // if set, internal events will trigger selection of all clubs
    // if user sets the club manually, we want to keep his selection
    var autoSelectAllClubs = true;
    var allClubCheckBoxes = $("#filter").find("input[type=checkbox]");
    allClubCheckBoxes.click(function () {
        autoSelectAllClubs = false;
    });
    // important to use function() (anonymous function) here an not an arrow function
    // using an arrow function will change the "this" inside
    $("[name='evnt_type']").click(function () {
        var prop = $(this).val();
        var isInternalEvent = internalEventValues.indexOf(prop) !== -1;
        if (isInternalEvent) {
            if (autoSelectAllClubs) {
                $("#filter").find("input[type=checkbox]").prop("checked", true);
            }
        }
        else {
            // reset all checkboxes
            $("#filter").find("input[type=checkbox]").prop("checked", false);
            var clubName = $(document).find("#place").val();
            var clubId = getIdOfClub(clubName);
            if (clubId !== -1) {
                var showToClubCheckbox = $(document).find("[name=filterShowToClub" + clubId + "]");
                showToClubCheckbox.prop("checked", true);
            }
        }
    });
});

///<reference path="../typings/index.d.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="../typings/index.d.ts"/>
var Question = (function () {
    function Question(element) {
        this.questionDiv = $(element).closest('[name^=question]');
    }
    return Question;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZVN1cnZleS50cyIsIlN0YXRpc3RpY3NWaWV3LnRzIiwiVXRpbGl0aWVzLnRzIiwiX3JlZmVyZW5jZXMudHMiLCJDcmVhdGVFZGl0RXZlbnQudHMiLCJFdmVudFZpZXcudHMiLCJRdWVzdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7SUFFakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sR0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUssR0FBRyxHQUFHLEdBQUcsTUFBTSxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7O0FDWkgscUNBQXFDO0FBRXJDLG9CQUFvQixDQUFTO0lBQ3pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QyxDQUFDO0FBRUQsc0JBQXNCLENBQVM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMs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QUFJLENBQUMsQ0FBQztZQUNGLHVCQUF1QjtZQUN2QixDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqRSxJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2hELElBQUksTUFBTSxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNoQixJQUFJLGtCQUFrQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDO2dCQUNuRixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzdDLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQzs7QUNqRUgsNENBQTRDO0FBQzVDLG1DQUFtQzs7QUNEbkMsNENBQTRDO0FBRTVDO0lBSUksa0JBQVksT0FBZTtRQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQ0wsZUFBQztBQUFELENBUEEsQUFPQyxJQUFBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5cclxuJChcIiNidXR0b24tY3JlYXRlLXN1cnZleVwiKS5jbGljaygoKSA9PiB7XHJcbiAgICBsZXQgZXJyb3JzID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuXHJcbiAgICBpZiAoJChcIiNkZXNjcmlwdGlvblwiKS52YWwoKS5sZW5ndGggID4gMTUwMCkge1xyXG4gICAgICAgIGVycm9ycy5wdXNoKHRyYW5zbGF0ZShcImRlc2NyaXB0aW9uVG9vTG9uZ1wiKSk7XHJcbiAgICB9XHJcbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBib290Ym94LmFsZXJ0KGVycm9ycy5tYXAoZXJyID0+IFwiPHA+XCIgKyBlcnIgKyBcIjwvcD5cIikuam9pbihcIlxcblwiKSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJfcmVmZXJlbmNlcy50c1wiLz5cclxuXHJcbmZ1bmN0aW9uIGdldFJvd05hbWUoYTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gJChhKS5jaGlsZHJlbihcInRkXCIpLmVxKDApLnRleHQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Um93U2hpZnRzKGE6IHN0cmluZykge1xyXG4gICAgcmV0dXJuICQoYSkuY2hpbGRyZW4oXCJ0ZFwiKS5lcSgxKS50ZXh0KCk7XHJcbn1cclxuXHJcblxyXG4vL2luc3BpcmVkIGJ5IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzE2MDI3Ny9qcXVlcnktdGFibGUtc29ydFxyXG5mdW5jdGlvbiBzb3J0TGVhZGVyYm9hcmRzKHNvcnRJY29uOiBKUXVlcnkpIHtcclxuICAgIGxldCBpc0FzY2VuZGluZyA9IHNvcnRJY29uLmhhc0NsYXNzKCdmYS1zb3J0LWFzYycpO1xyXG4gICAgbGV0IHJvd0NhdGNoZXIgPSBzb3J0SWNvbi5wYXJlbnQoKS5kYXRhKCdzb3J0JykgPT09ICduYW1lJyA/IGdldFJvd05hbWUgOiBnZXRSb3dTaGlmdHM7XHJcbiAgICBsZXQgJHRhYmxlID0gc29ydEljb24ucGFyZW50cyhcInRhYmxlXCIpO1xyXG4gICAgbGV0IHJvd3MgPSAkdGFibGVcclxuICAgICAgICAuZmluZChcInRib2R5XCIpXHJcbiAgICAgICAgLmZpbmQoXCJ0clwiKVxyXG4gICAgICAgIC50b0FycmF5KClcclxuICAgICAgICAuc29ydCgoYSwgYikgPT4gcm93Q2F0Y2hlcihhKS5sb2NhbGVDb21wYXJlKHJvd0NhdGNoZXIoYiksIHVuZGVmaW5lZCwgeydudW1lcmljJzogdHJ1ZX0pKTtcclxuICAgIGlmICghaXNBc2NlbmRpbmcpIHtcclxuICAgICAgICByb3dzLnJldmVyc2UoKTtcclxuICAgIH1cclxuICAgIHJvd3MuZm9yRWFjaChyb3cgPT4gJHRhYmxlLmFwcGVuZCgkKHJvdykpKTtcclxuICAgIHNvcnRJY29uLnBhcmVudHMoJ3RhYmxlJylcclxuICAgICAgICAuZmluZCgnLmZhLXNvcnQsIC5mYS1zb3J0LWRlc2MsIC5mYS1zb3J0LWFzYycpXHJcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdmYS1zb3J0LWFzYycpXHJcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdmYS1zb3J0LWRlc2MnKVxyXG4gICAgICAgIC5hZGRDbGFzcygnZmEtc29ydCcpO1xyXG4gICAgc29ydEljb24ucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQnKVxyXG4gICAgICAgIC5hZGRDbGFzcyhpc0FzY2VuZGluZyA/ICdmYS1zb3J0LWRlc2MnIDogJ2ZhLXNvcnQtYXNjJyk7XHJcbn1cclxuJChcIi5mYS1zb3J0LCAuZmEtc29ydC1kZXNjLCAuZmEtc29ydC1hc2NcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgc29ydExlYWRlcmJvYXJkcyh0aGlzKTtcclxufSk7XHJcblxyXG4kKCcjbGVhZGVyYm9hcmRzVGFicycpLmZpbmQoJ3RoZWFkJykuZmluZCgndGQnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIHNvcnRMZWFkZXJib2FyZHMoJCgkKHRoaXMpLmZpbmQoJ2knKS5maXJzdCgpKSk7XHJcbn0pO1xyXG5cclxuJChcIi5zdGF0aXN0aWNDbHViUGlja2VyXCIpLmZpbmQoXCJhXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgbGV0IGNsdWJOYW1lID0gJCh0aGlzKS50ZXh0KCkudHJpbSgpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcnJlZFN0YXRpc3RpY3MnLCBjbHViTmFtZSk7XHJcbn0pO1xyXG5cclxuJCgoKSA9PiB7XHJcbiAgICBsZXQgcHJlZmVyZW5jZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcmVmZXJyZWRTdGF0aXN0aWNzJyk7XHJcbiAgICBpZiAocHJlZmVyZW5jZSkge1xyXG4gICAgICAgICQoJy5zdGF0aXN0aWNDbHViUGlja2VyJykuZmluZCgnYScpLmZpbHRlcihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICQodGhpcykudGV4dCgpLnRyaW0oKSA9PT0gcHJlZmVyZW5jZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuZmlyc3QoKVxyXG4gICAgICAgICAgICAuY2xpY2soKTtcclxuICAgIH1cclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5lbnVtIENsdWIge1xyXG4gICAgTm9uZSxcclxuICAgIEJjQ2x1YiA9IDIsXHJcbiAgICBCY0NhZmUsXHJcbiAgICBCZENsdWIsXHJcbiAgICBCaENsdWIsXHJcbiAgICBCaUNsdWJcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SWRPZkNsdWIgKGNsdWI6IHN0cmluZyk6IENsdWIge1xyXG4gICAgc3dpdGNoIChjbHViKSB7XHJcbiAgICAgICAgY2FzZSBcImJjLUNsdWJcIjpcclxuICAgICAgICAgICAgcmV0dXJuIENsdWIuQmNDbHViO1xyXG4gICAgICAgIGNhc2UgXCJiYy1DYWbDqVwiOlxyXG4gICAgICAgICAgICByZXR1cm4gQ2x1Yi5CY0NhZmU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQ2x1Yi5Ob25lO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzaG93RXJyb3JNb2RhbChtZXNzYWdlOiBzdHJpbmcpIHtcclxuICAgICQoXCIjZXJyb3JNb2RhbFwiKS5tb2RhbChcInNob3dcIik7XHJcbiAgICAkKFwiI2Vycm9yTW9kYWxcIikuZmluZChcIi5tb2RhbC1ib2R5XCIpLmh0bWwobWVzc2FnZSk7XHJcbn1cclxuIiwiLy8gZXh0ZXJuYWwgcmVmZXJlbmNlcyBnbyBoZXJlXHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbi8vIGludGVybmFsIHJlZmVyZW5jZSBnbyBoZXJlXHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIkNyZWF0ZUVkaXRFdmVudC50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiQ3JlYXRlU3VydmV5LnRzXCIvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJTdGF0aXN0aWNzVmlldy50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiVXRpbGl0aWVzLnRzXCIvPlxyXG5cclxuZGVjbGFyZSBsZXQgdHJhbnNsYXRlOiAoa2V5OiBzdHJpbmcpID0+IHN0cmluZztcclxuXHJcblxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJfcmVmZXJlbmNlcy50c1wiLz5cclxuXHJcbi8vIHZhbHVlcyBvZiBldmVudHMgdGhhdCBzaG91bGQgdHJpZ2dlciB0aGUgc2VsZWN0aW9uIG9mIGFsbCBjbHVic1xyXG5sZXQgaW50ZXJuYWxFdmVudFZhbHVlcyA9IFtcclxuICAgIFwiMVwiLCAvLyBJbmZvXHJcbiAgICBcIjRcIiwgLy8gSW50ZXJuYWwgZXZlbnRcclxuICAgIFwiNVwiLCAvLyBwcml2YXRlIHBhcnR5XHJcbiAgICBcIjZcIiwgLy8gY2xlYW5pbmdcclxuICAgIFwiOVwiICAvLyBvdGhlclxyXG5dO1xyXG5cclxuJChcIiNidXR0b24tY3JlYXRlLXN1Ym1pdFwiKS5hZGQoXCIjYnV0dG9uLWVkaXQtc3VibWl0XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICBsZXQgYmVnaW5EYXRlID0gbmV3IERhdGUoJChcIltuYW1lPSdiZWdpbkRhdGUnXVwiKS5wcm9wKFwidmFsdWVcIikgKyBcIiBcIiArICQoXCJbbmFtZT0nYmVnaW5UaW1lJ11cIikucHJvcChcInZhbHVlXCIpKTtcclxuICAgIGxldCBlbmREYXRlID0gbmV3IERhdGUoJChcIltuYW1lPSdlbmREYXRlJ11cIikucHJvcChcInZhbHVlXCIpICsgXCIgXCIgKyAkKFwiW25hbWU9J2VuZFRpbWUnXVwiKS5wcm9wKFwidmFsdWVcIikpO1xyXG5cclxuICAgIC8vIGNvbnRhaW5zIHRoZSBrZXlzIHRvIHRyYW5zbGF0aW9ucyB0byBiZSBzaG93biBpZiB0aGUgY29uZGl0aW9uIGlzIGZ1bGZpbGxlZFxyXG4gICAgbGV0IGVycm9yQ29uZGl0aW9uczoge1trZXk6IHN0cmluZ106IGJvb2xlYW59ID0ge1xyXG4gICAgICAgICdlbmRCZWZvcmVTdGFydCc6IGJlZ2luRGF0ZS5nZXRUaW1lKCkgPiBlbmREYXRlLmdldFRpbWUoKSxcclxuICAgICAgICAnZm9yZ290RmlsdGVyJzogJChcIiNmaWx0ZXItY2hlY2tib3hlc1wiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF06Y2hlY2tlZFwiKS5sZW5ndGggPT09IDAsXHJcbiAgICAgICAgJ2ZvcmdvdFByZXBhcmF0aW9uJzogJCgnW25hbWU9XCJwcmVwYXJhdGlvblRpbWVcIl0nKS52YWwoKSA9PT0gXCJcIixcclxuICAgICAgICAnZm9yZ290U3RhcnRUaW1lJzogJCgnW25hbWU9XCJiZWdpblRpbWVcIl0nKS52YWwoKSA9PT0gXCJcIixcclxuICAgICAgICAnZm9yZ290RW5kVGltZSc6ICQoJ1tuYW1lPVwiZW5kVGltZVwiXScpLnZhbCgpID09PSBcIlwiXHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBlcnJvcnMgPSBPYmplY3Qua2V5cyhlcnJvckNvbmRpdGlvbnMpXHJcbiAgICAgICAgLmZpbHRlcihrZXkgPT4gZXJyb3JDb25kaXRpb25zW2tleV0pXHJcbiAgICAgICAgLm1hcChrZXkgPT4gdHJhbnNsYXRlKGtleSkpO1xyXG5cclxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGJvb3Rib3guYWxlcnQoZXJyb3JzLm1hcChlcnIgPT4gXCI8cD5cIiArIGVyciArIFwiPC9wPlwiKS5qb2luKFwiXFxuXCIpKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn0pO1xyXG4kKCgpID0+IHtcclxuICAgIC8vIGlmIHNldCwgaW50ZXJuYWwgZXZlbnRzIHdpbGwgdHJpZ2dlciBzZWxlY3Rpb24gb2YgYWxsIGNsdWJzXHJcbiAgICAvLyBpZiB1c2VyIHNldHMgdGhlIGNsdWIgbWFudWFsbHksIHdlIHdhbnQgdG8ga2VlcCBoaXMgc2VsZWN0aW9uXHJcbiAgICBsZXQgYXV0b1NlbGVjdEFsbENsdWJzID0gdHJ1ZTtcclxuICAgIGxldCBhbGxDbHViQ2hlY2tCb3hlcyA9ICQoXCIjZmlsdGVyXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKTtcclxuICAgIGFsbENsdWJDaGVja0JveGVzLmNsaWNrKCgpID0+IHtcclxuICAgICAgICBhdXRvU2VsZWN0QWxsQ2x1YnMgPSBmYWxzZTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGltcG9ydGFudCB0byB1c2UgZnVuY3Rpb24oKSAoYW5vbnltb3VzIGZ1bmN0aW9uKSBoZXJlIGFuIG5vdCBhbiBhcnJvdyBmdW5jdGlvblxyXG4gICAgLy8gdXNpbmcgYW4gYXJyb3cgZnVuY3Rpb24gd2lsbCBjaGFuZ2UgdGhlIFwidGhpc1wiIGluc2lkZVxyXG4gICAgJChcIltuYW1lPSdldm50X3R5cGUnXVwiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IHByb3AgPSAkKHRoaXMpLnZhbCgpO1xyXG4gICAgICAgIGxldCBpc0ludGVybmFsRXZlbnQgPSBpbnRlcm5hbEV2ZW50VmFsdWVzLmluZGV4T2YocHJvcCkgIT09IC0xO1xyXG4gICAgICAgIGlmIChpc0ludGVybmFsRXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGF1dG9TZWxlY3RBbGxDbHVicykge1xyXG4gICAgICAgICAgICAgICAgJChcIiNmaWx0ZXJcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpLnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyByZXNldCBhbGwgY2hlY2tib3hlc1xyXG4gICAgICAgICAgICAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIikucHJvcChcImNoZWNrZWRcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBsZXQgY2x1Yk5hbWUgPSAkKGRvY3VtZW50KS5maW5kKFwiI3BsYWNlXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICBsZXQgY2x1YklkID0gZ2V0SWRPZkNsdWIoY2x1Yk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNsdWJJZCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzaG93VG9DbHViQ2hlY2tib3ggPSAkKGRvY3VtZW50KS5maW5kKFwiW25hbWU9ZmlsdGVyU2hvd1RvQ2x1YlwiICsgY2x1YklkICsgXCJdXCIpO1xyXG4gICAgICAgICAgICAgICAgc2hvd1RvQ2x1YkNoZWNrYm94LnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJVdGlsaXRpZXMudHNcIi8+XHJcblxyXG5cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxyXG5cclxuY2xhc3MgUXVlc3Rpb24ge1xyXG5cclxuICAgIHByaXZhdGUgcXVlc3Rpb25EaXY6IEpRdWVyeTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnF1ZXN0aW9uRGl2ID0gJChlbGVtZW50KS5jbG9zZXN0KCdbbmFtZV49cXVlc3Rpb25dJyk7XHJcbiAgICB9XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
