///<reference path="_references.ts"/>
$("#button-create-survey").click(function () {
    var errors = new Array();
    if ($("#description").val().length > 1500) {
        errors.push(translate("descriptionTooLong"));
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});

///<reference path="_references.ts"/>
function getRowName(a) {
    return $(a).children("td").eq(0).text();
}
function getRowShifts(a) {
    return $(a).children("td").eq(1).text();
}
//inspired by http://stackoverflow.com/questions/3160277/jquery-table-sort
function sortTable($table, byName, descending) {
    var rowCatcher = byName ? getRowName : getRowShifts;
    var rows = $table
        .find("tbody")
        .find("tr")
        .toArray()
        .sort(function (a, b) { return rowCatcher(a).localeCompare(rowCatcher(b), undefined, { 'numeric': true }); });
    if (descending) {
        rows.reverse();
    }
    rows.forEach(function (row) { return $table.append($(row)); });
}
function updateSortIconStyle($table, byName, descending) {
    // remove specific sorting from all icons
    $table.find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .removeClass('fa-sort-asc')
        .removeClass('fa-sort-desc')
        .addClass('fa-sort');
    // and add the current sorting order to the one that changed
    var icon = $table.find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .filter(function () {
        var sortIdentifier = byName ? 'name' : 'shifts';
        return $(this).parent().data('sort') === sortIdentifier;
    });
    icon.removeClass('fa-sort')
        .addClass(descending ? 'fa-sort-desc' : 'fa-sort-asc');
}
function sortLeaderboards(sortIcon) {
    var $table = sortIcon.parents("table");
    var wasAscending = sortIcon.hasClass('fa-sort-asc');
    var isNameSort = sortIcon.parent().data('sort') === 'name';
    localStorage.setItem('preferredSortType', isNameSort ? 'name' : 'shifts');
    localStorage.setItem('preferredSortOrder', wasAscending ? 'descending' : 'ascending');
    sortTable($table, isNameSort, wasAscending);
    updateSortIconStyle($table, isNameSort, wasAscending);
}
$(".fa-sort, .fa-sort-desc, .fa-sort-asc").click(function () {
    sortLeaderboards(this);
});
$('#memberStatisticsTabs').find('thead').find('td').click(function () {
    sortLeaderboards($($(this).find('i').first()));
});
$(".statisticClubPicker").find("a").click(function () {
    var clubName = $(this).text().trim();
    localStorage.setItem('preferredStatistics', clubName);
});
$(".leaderboardsClubPicker").find("a").click(function () {
    var leaderBoardName = $(this).text().trim();
    localStorage.setItem('preferredLeaderboards', leaderBoardName);
});
$(function () {
    var preferredStatistics = localStorage.getItem('preferredStatistics');
    if (preferredStatistics) {
        $('.statisticClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredStatistics;
        })
            .first()
            .click();
    }
    var preferredLeaderboards = localStorage.getItem('preferredLeaderboards');
    if (preferredLeaderboards) {
        $('.leaderboardsClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredLeaderboards;
        })
            .first()
            .click();
    }
    var preferredSortType = localStorage.getItem('preferredSortType');
    var preferredSortOrder = localStorage.getItem('preferredSortOrder');
    var $tables = $('#memberStatisticsTabs').find('table');
    var isNameSort = preferredSortType === 'name';
    var isDescending = preferredSortOrder === 'descending';
    $tables.each(function () {
        sortTable($(this), isNameSort, isDescending);
        updateSortIconStyle($(this), isNameSort, isDescending);
    });
});

///<reference path="_references.ts"/>
var Club;
(function (Club) {
    Club[Club["None"] = 0] = "None";
    Club[Club["BcClub"] = 2] = "BcClub";
    Club[Club["BcCafe"] = 3] = "BcCafe";
    Club[Club["BdClub"] = 4] = "BdClub";
    Club[Club["BhClub"] = 5] = "BhClub";
    Club[Club["BiClub"] = 6] = "BiClub";
})(Club || (Club = {}));
function getIdOfClub(club) {
    switch (club) {
        case "bc-Club":
            return Club.BcClub;
        case "bc-Caf√©":
            return Club.BcCafe;
    }
    return Club.None;
}
function showErrorModal(message) {
    $("#errorModal").modal("show");
    $("#errorModal").find(".modal-body").html(message);
}

// external references go here
///<reference path="../typings/index.d.ts"/>
///<reference path="CreateEditEvent.ts"/>
///<reference path="CreateSurvey.ts"/>
///<reference path="StatisticsView.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="_references.ts"/>
// values of events that should trigger the selection of all clubs
var internalEventValues = [
    "1",
    "4",
    "5",
    "6",
    "9" // other
];
$("#button-create-submit").add("#button-edit-submit").click(function () {
    var beginDate = new Date($("[name='beginDate']").prop("value") + " " + $("[name='beginTime']").prop("value"));
    var endDate = new Date($("[name='endDate']").prop("value") + " " + $("[name='endTime']").prop("value"));
    // contains the keys to translations to be shown if the condition is fulfilled
    var errorConditions = {
        'endBeforeStart': beginDate.getTime() > endDate.getTime(),
        'forgotFilter': $("#filter-checkboxes").find("input[type=checkbox]:checked").length === 0,
        'forgotPreparation': $('[name="preparationTime"]').val() === "",
        'forgotStartTime': $('[name="beginTime"]').val() === "",
        'forgotEndTime': $('[name="endTime"]').val() === ""
    };
    var errors = Object.keys(errorConditions)
        .filter(function (key) { return errorConditions[key]; })
        .map(function (key) { return translate(key); });
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});
$(function () {
    // if set, internal events will trigger selection of all clubs
    // if user sets the club manually, we want to keep his selection
    var autoSelectAllClubs = true;
    var allClubCheckBoxes = $("#filter").find("input[type=checkbox]");
    allClubCheckBoxes.click(function () {
        autoSelectAllClubs = false;
    });
    // important to use function() (anonymous function) here an not an arrow function
    // using an arrow function will change the "this" inside
    $("[name='evnt_type']").click(function () {
        var prop = $(this).val();
        var isInternalEvent = internalEventValues.indexOf(prop) !== -1;
        if (isInternalEvent) {
            if (autoSelectAllClubs) {
                $("#filter").find("input[type=checkbox]").prop("checked", true);
            }
        }
        else {
            // reset all checkboxes
            $("#filter").find("input[type=checkbox]").prop("checked", false);
            var clubName = $(document).find("#place").val();
            var clubId = getIdOfClub(clubName);
            if (clubId !== -1) {
                var showToClubCheckbox = $(document).find("[name=filterShowToClub" + clubId + "]");
                showToClubCheckbox.prop("checked", true);
            }
        }
    });
});

///<reference path="../typings/index.d.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="../typings/index.d.ts"/>
var Question = (function () {
    function Question(element) {
        this.questionDiv = $(element).closest('[name^=question]');
    }
    return Question;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZVN1cnZleS50cyIsIlN0YXRpc3RpY3NWaWV3LnRzIiwiVXRpbGl0aWVzLnRzIiwiX3JlZmVyZW5jZXMudHMiLCJDcmVhdGVFZGl0RXZlbnQudHMiLCJFdmVudFZpZXcudHMiLCJRdWVzdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7SUFFakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sR0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUssR0FBRyxHQUFHLEdBQUcsTUFBTSxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7O0FDWkgscUNBQXFDO0FBRXJDLG9CQUFvQixDQUFTO0lBQ3pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QyxDQUFDO0FBRUQsc0JBQXNCLENBQVM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMs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LENBQUM7WUFDaEQsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRW5DLEVBQUUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hCLElBQUksa0JBQWtCLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ25GLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDOztBQ2pFSCw0Q0FBNEM7QUFDNUMsbUNBQW1DOztBQ0RuQyw0Q0FBNEM7QUFFNUM7SUFJSSxrQkFBWSxPQUFlO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFDTCxlQUFDO0FBQUQsQ0FQQSxBQU9DLElBQUEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XG5cbiQoXCIjYnV0dG9uLWNyZWF0ZS1zdXJ2ZXlcIikuY2xpY2soKCkgPT4ge1xuICAgIGxldCBlcnJvcnMgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xuXG4gICAgaWYgKCQoXCIjZGVzY3JpcHRpb25cIikudmFsKCkubGVuZ3RoICA+IDE1MDApIHtcbiAgICAgICAgZXJyb3JzLnB1c2godHJhbnNsYXRlKFwiZGVzY3JpcHRpb25Ub29Mb25nXCIpKTtcbiAgICB9XG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGJvb3Rib3guYWxlcnQoZXJyb3JzLm1hcChlcnIgPT4gXCI8cD5cIiArIGVyciArIFwiPC9wPlwiKS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn0pO1xuXG5cbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxuXG5mdW5jdGlvbiBnZXRSb3dOYW1lKGE6IHN0cmluZykge1xuICAgIHJldHVybiAkKGEpLmNoaWxkcmVuKFwidGRcIikuZXEoMCkudGV4dCgpO1xufVxuXG5mdW5jdGlvbiBnZXRSb3dTaGlmdHMoYTogc3RyaW5nKSB7XG4gICAgcmV0dXJuICQoYSkuY2hpbGRyZW4oXCJ0ZFwiKS5lcSgxKS50ZXh0KCk7XG59XG5cblxuLy9pbnNwaXJlZCBieSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMxNjAyNzcvanF1ZXJ5LXRhYmxlLXNvcnRcbmZ1bmN0aW9uIHNvcnRUYWJsZSgkdGFibGU6IEpRdWVyeSwgYnlOYW1lOiBib29sZWFuLCBkZXNjZW5kaW5nOiBib29sZWFuKSB7XG4gICAgbGV0IHJvd0NhdGNoZXIgPSBieU5hbWUgPyBnZXRSb3dOYW1lIDogZ2V0Um93U2hpZnRzO1xuICAgIGxldCByb3dzID0gJHRhYmxlXG4gICAgICAgIC5maW5kKFwidGJvZHlcIilcbiAgICAgICAgLmZpbmQoXCJ0clwiKVxuICAgICAgICAudG9BcnJheSgpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiByb3dDYXRjaGVyKGEpLmxvY2FsZUNvbXBhcmUocm93Q2F0Y2hlcihiKSwgdW5kZWZpbmVkLCB7J251bWVyaWMnOiB0cnVlfSkpO1xuICAgIGlmIChkZXNjZW5kaW5nKSB7XG4gICAgICAgIHJvd3MucmV2ZXJzZSgpO1xuICAgIH1cbiAgICByb3dzLmZvckVhY2gocm93ID0+ICR0YWJsZS5hcHBlbmQoJChyb3cpKSk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVNvcnRJY29uU3R5bGUoJHRhYmxlOiBKUXVlcnksIGJ5TmFtZTogYm9vbGVhbiwgZGVzY2VuZGluZzogYm9vbGVhbikge1xuICAgIC8vIHJlbW92ZSBzcGVjaWZpYyBzb3J0aW5nIGZyb20gYWxsIGljb25zXG4gICAgJHRhYmxlLmZpbmQoJy5mYS1zb3J0LCAuZmEtc29ydC1kZXNjLCAuZmEtc29ydC1hc2MnKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQtYXNjJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdmYS1zb3J0LWRlc2MnKVxuICAgICAgICAuYWRkQ2xhc3MoJ2ZhLXNvcnQnKTtcbiAgICAvLyBhbmQgYWRkIHRoZSBjdXJyZW50IHNvcnRpbmcgb3JkZXIgdG8gdGhlIG9uZSB0aGF0IGNoYW5nZWRcbiAgICBsZXQgaWNvbiA9ICR0YWJsZS5maW5kKCcuZmEtc29ydCwgLmZhLXNvcnQtZGVzYywgLmZhLXNvcnQtYXNjJylcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgc29ydElkZW50aWZpZXIgPSBieU5hbWUgPyAnbmFtZScgOiAnc2hpZnRzJztcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnBhcmVudCgpLmRhdGEoJ3NvcnQnKSA9PT0gc29ydElkZW50aWZpZXI7XG4gICAgICAgIH0pO1xuICAgIGljb24ucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQnKVxuICAgICAgICAuYWRkQ2xhc3MoZGVzY2VuZGluZyA/ICdmYS1zb3J0LWRlc2MnIDogJ2ZhLXNvcnQtYXNjJyk7XG59XG5cbmZ1bmN0aW9uIHNvcnRMZWFkZXJib2FyZHMoc29ydEljb246IEpRdWVyeSkge1xuICAgIGxldCAkdGFibGUgPSBzb3J0SWNvbi5wYXJlbnRzKFwidGFibGVcIik7XG4gICAgbGV0IHdhc0FzY2VuZGluZyA9IHNvcnRJY29uLmhhc0NsYXNzKCdmYS1zb3J0LWFzYycpO1xuICAgIGxldCBpc05hbWVTb3J0ID0gc29ydEljb24ucGFyZW50KCkuZGF0YSgnc29ydCcpID09PSAnbmFtZSc7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJlZmVycmVkU29ydFR5cGUnLCBpc05hbWVTb3J0ID8gJ25hbWUnIDogJ3NoaWZ0cycpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcmVmZXJyZWRTb3J0T3JkZXInLCB3YXNBc2NlbmRpbmcgPyAnZGVzY2VuZGluZycgOiAnYXNjZW5kaW5nJyk7XG5cbiAgICBzb3J0VGFibGUoJHRhYmxlLCBpc05hbWVTb3J0LCB3YXNBc2NlbmRpbmcpO1xuICAgIHVwZGF0ZVNvcnRJY29uU3R5bGUoJHRhYmxlLCBpc05hbWVTb3J0LCB3YXNBc2NlbmRpbmcpO1xufVxuXG4kKFwiLmZhLXNvcnQsIC5mYS1zb3J0LWRlc2MsIC5mYS1zb3J0LWFzY1wiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgc29ydExlYWRlcmJvYXJkcyh0aGlzKTtcbn0pO1xuXG4kKCcjbWVtYmVyU3RhdGlzdGljc1RhYnMnKS5maW5kKCd0aGVhZCcpLmZpbmQoJ3RkJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgc29ydExlYWRlcmJvYXJkcygkKCQodGhpcykuZmluZCgnaScpLmZpcnN0KCkpKTtcbn0pO1xuXG4kKFwiLnN0YXRpc3RpY0NsdWJQaWNrZXJcIikuZmluZChcImFcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgbGV0IGNsdWJOYW1lID0gJCh0aGlzKS50ZXh0KCkudHJpbSgpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcmVmZXJyZWRTdGF0aXN0aWNzJywgY2x1Yk5hbWUpO1xufSk7XG5cbiQoXCIubGVhZGVyYm9hcmRzQ2x1YlBpY2tlclwiKS5maW5kKFwiYVwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICBsZXQgbGVhZGVyQm9hcmROYW1lID0gJCh0aGlzKS50ZXh0KCkudHJpbSgpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcmVmZXJyZWRMZWFkZXJib2FyZHMnLCBsZWFkZXJCb2FyZE5hbWUpO1xufSk7XG5cbiQoKCkgPT4ge1xuICAgIGxldCBwcmVmZXJyZWRTdGF0aXN0aWNzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3ByZWZlcnJlZFN0YXRpc3RpY3MnKTtcbiAgICBpZiAocHJlZmVycmVkU3RhdGlzdGljcykge1xuICAgICAgICAkKCcuc3RhdGlzdGljQ2x1YlBpY2tlcicpLmZpbmQoJ2EnKS5maWx0ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpID09PSBwcmVmZXJyZWRTdGF0aXN0aWNzO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmZpcnN0KClcbiAgICAgICAgICAgIC5jbGljaygpO1xuICAgIH1cblxuICAgIGxldCBwcmVmZXJyZWRMZWFkZXJib2FyZHMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJlZmVycmVkTGVhZGVyYm9hcmRzJyk7XG4gICAgaWYgKHByZWZlcnJlZExlYWRlcmJvYXJkcykge1xuICAgICAgICAkKCcubGVhZGVyYm9hcmRzQ2x1YlBpY2tlcicpLmZpbmQoJ2EnKS5maWx0ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpID09PSBwcmVmZXJyZWRMZWFkZXJib2FyZHM7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuZmlyc3QoKVxuICAgICAgICAgICAgLmNsaWNrKCk7XG4gICAgfVxuXG4gICAgbGV0IHByZWZlcnJlZFNvcnRUeXBlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3ByZWZlcnJlZFNvcnRUeXBlJyk7XG4gICAgbGV0IHByZWZlcnJlZFNvcnRPcmRlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcmVmZXJyZWRTb3J0T3JkZXInKTtcblxuICAgIGxldCAkdGFibGVzID0gJCgnI21lbWJlclN0YXRpc3RpY3NUYWJzJykuZmluZCgndGFibGUnKTtcbiAgICBsZXQgaXNOYW1lU29ydCA9IHByZWZlcnJlZFNvcnRUeXBlID09PSAnbmFtZSc7XG4gICAgbGV0IGlzRGVzY2VuZGluZyA9IHByZWZlcnJlZFNvcnRPcmRlciA9PT0gJ2Rlc2NlbmRpbmcnO1xuXG4gICAgJHRhYmxlcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBzb3J0VGFibGUoJCh0aGlzKSwgaXNOYW1lU29ydCwgaXNEZXNjZW5kaW5nKTtcbiAgICAgICAgdXBkYXRlU29ydEljb25TdHlsZSgkKHRoaXMpLCBpc05hbWVTb3J0LCBpc0Rlc2NlbmRpbmcpO1xuICAgIH0pXG5cbn0pO1xuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XG5lbnVtIENsdWIge1xuICAgIE5vbmUsXG4gICAgQmNDbHViID0gMixcbiAgICBCY0NhZmUsXG4gICAgQmRDbHViLFxuICAgIEJoQ2x1YixcbiAgICBCaUNsdWJcbn1cblxuZnVuY3Rpb24gZ2V0SWRPZkNsdWIgKGNsdWI6IHN0cmluZyk6IENsdWIge1xuICAgIHN3aXRjaCAoY2x1Yikge1xuICAgICAgICBjYXNlIFwiYmMtQ2x1YlwiOlxuICAgICAgICAgICAgcmV0dXJuIENsdWIuQmNDbHViO1xuICAgICAgICBjYXNlIFwiYmMtQ2Fmw6lcIjpcbiAgICAgICAgICAgIHJldHVybiBDbHViLkJjQ2FmZTtcbiAgICB9XG4gICAgcmV0dXJuIENsdWIuTm9uZTtcbn1cblxuZnVuY3Rpb24gc2hvd0Vycm9yTW9kYWwobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgJChcIiNlcnJvck1vZGFsXCIpLm1vZGFsKFwic2hvd1wiKTtcbiAgICAkKFwiI2Vycm9yTW9kYWxcIikuZmluZChcIi5tb2RhbC1ib2R5XCIpLmh0bWwobWVzc2FnZSk7XG59XG4iLCIvLyBleHRlcm5hbCByZWZlcmVuY2VzIGdvIGhlcmVcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cblxuLy8gaW50ZXJuYWwgcmVmZXJlbmNlIGdvIGhlcmVcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIkNyZWF0ZUVkaXRFdmVudC50c1wiLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIkNyZWF0ZVN1cnZleS50c1wiLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIlN0YXRpc3RpY3NWaWV3LnRzXCIvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiVXRpbGl0aWVzLnRzXCIvPlxuXG5kZWNsYXJlIGxldCB0cmFuc2xhdGU6IChrZXk6IHN0cmluZykgPT4gc3RyaW5nO1xuXG5cbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxuXG4vLyB2YWx1ZXMgb2YgZXZlbnRzIHRoYXQgc2hvdWxkIHRyaWdnZXIgdGhlIHNlbGVjdGlvbiBvZiBhbGwgY2x1YnNcbmxldCBpbnRlcm5hbEV2ZW50VmFsdWVzID0gW1xuICAgIFwiMVwiLCAvLyBJbmZvXG4gICAgXCI0XCIsIC8vIEludGVybmFsIGV2ZW50XG4gICAgXCI1XCIsIC8vIHByaXZhdGUgcGFydHlcbiAgICBcIjZcIiwgLy8gY2xlYW5pbmdcbiAgICBcIjlcIiAgLy8gb3RoZXJcbl07XG5cbiQoXCIjYnV0dG9uLWNyZWF0ZS1zdWJtaXRcIikuYWRkKFwiI2J1dHRvbi1lZGl0LXN1Ym1pdFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICBsZXQgYmVnaW5EYXRlID0gbmV3IERhdGUoJChcIltuYW1lPSdiZWdpbkRhdGUnXVwiKS5wcm9wKFwidmFsdWVcIikgKyBcIiBcIiArICQoXCJbbmFtZT0nYmVnaW5UaW1lJ11cIikucHJvcChcInZhbHVlXCIpKTtcbiAgICBsZXQgZW5kRGF0ZSA9IG5ldyBEYXRlKCQoXCJbbmFtZT0nZW5kRGF0ZSddXCIpLnByb3AoXCJ2YWx1ZVwiKSArIFwiIFwiICsgJChcIltuYW1lPSdlbmRUaW1lJ11cIikucHJvcChcInZhbHVlXCIpKTtcblxuICAgIC8vIGNvbnRhaW5zIHRoZSBrZXlzIHRvIHRyYW5zbGF0aW9ucyB0byBiZSBzaG93biBpZiB0aGUgY29uZGl0aW9uIGlzIGZ1bGZpbGxlZFxuICAgIGxldCBlcnJvckNvbmRpdGlvbnM6IHtba2V5OiBzdHJpbmddOiBib29sZWFufSA9IHtcbiAgICAgICAgJ2VuZEJlZm9yZVN0YXJ0JzogYmVnaW5EYXRlLmdldFRpbWUoKSA+IGVuZERhdGUuZ2V0VGltZSgpLFxuICAgICAgICAnZm9yZ290RmlsdGVyJzogJChcIiNmaWx0ZXItY2hlY2tib3hlc1wiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF06Y2hlY2tlZFwiKS5sZW5ndGggPT09IDAsXG4gICAgICAgICdmb3Jnb3RQcmVwYXJhdGlvbic6ICQoJ1tuYW1lPVwicHJlcGFyYXRpb25UaW1lXCJdJykudmFsKCkgPT09IFwiXCIsXG4gICAgICAgICdmb3Jnb3RTdGFydFRpbWUnOiAkKCdbbmFtZT1cImJlZ2luVGltZVwiXScpLnZhbCgpID09PSBcIlwiLFxuICAgICAgICAnZm9yZ290RW5kVGltZSc6ICQoJ1tuYW1lPVwiZW5kVGltZVwiXScpLnZhbCgpID09PSBcIlwiXG4gICAgfTtcblxuICAgIGxldCBlcnJvcnMgPSBPYmplY3Qua2V5cyhlcnJvckNvbmRpdGlvbnMpXG4gICAgICAgIC5maWx0ZXIoa2V5ID0+IGVycm9yQ29uZGl0aW9uc1trZXldKVxuICAgICAgICAubWFwKGtleSA9PiB0cmFuc2xhdGUoa2V5KSk7XG5cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYm9vdGJveC5hbGVydChlcnJvcnMubWFwKGVyciA9PiBcIjxwPlwiICsgZXJyICsgXCI8L3A+XCIpLmpvaW4oXCJcXG5cIikpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG4kKCgpID0+IHtcbiAgICAvLyBpZiBzZXQsIGludGVybmFsIGV2ZW50cyB3aWxsIHRyaWdnZXIgc2VsZWN0aW9uIG9mIGFsbCBjbHVic1xuICAgIC8vIGlmIHVzZXIgc2V0cyB0aGUgY2x1YiBtYW51YWxseSwgd2Ugd2FudCB0byBrZWVwIGhpcyBzZWxlY3Rpb25cbiAgICBsZXQgYXV0b1NlbGVjdEFsbENsdWJzID0gdHJ1ZTtcbiAgICBsZXQgYWxsQ2x1YkNoZWNrQm94ZXMgPSAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIik7XG4gICAgYWxsQ2x1YkNoZWNrQm94ZXMuY2xpY2soKCkgPT4ge1xuICAgICAgICBhdXRvU2VsZWN0QWxsQ2x1YnMgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8vIGltcG9ydGFudCB0byB1c2UgZnVuY3Rpb24oKSAoYW5vbnltb3VzIGZ1bmN0aW9uKSBoZXJlIGFuIG5vdCBhbiBhcnJvdyBmdW5jdGlvblxuICAgIC8vIHVzaW5nIGFuIGFycm93IGZ1bmN0aW9uIHdpbGwgY2hhbmdlIHRoZSBcInRoaXNcIiBpbnNpZGVcbiAgICAkKFwiW25hbWU9J2V2bnRfdHlwZSddXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHByb3AgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICBsZXQgaXNJbnRlcm5hbEV2ZW50ID0gaW50ZXJuYWxFdmVudFZhbHVlcy5pbmRleE9mKHByb3ApICE9PSAtMTtcbiAgICAgICAgaWYgKGlzSW50ZXJuYWxFdmVudCkge1xuICAgICAgICAgICAgaWYgKGF1dG9TZWxlY3RBbGxDbHVicykge1xuICAgICAgICAgICAgICAgICQoXCIjZmlsdGVyXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKS5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHJlc2V0IGFsbCBjaGVja2JveGVzXG4gICAgICAgICAgICAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIikucHJvcChcImNoZWNrZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgbGV0IGNsdWJOYW1lID0gJChkb2N1bWVudCkuZmluZChcIiNwbGFjZVwiKS52YWwoKTtcbiAgICAgICAgICAgIGxldCBjbHViSWQgPSBnZXRJZE9mQ2x1YihjbHViTmFtZSk7XG5cbiAgICAgICAgICAgIGlmIChjbHViSWQgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNob3dUb0NsdWJDaGVja2JveCA9ICQoZG9jdW1lbnQpLmZpbmQoXCJbbmFtZT1maWx0ZXJTaG93VG9DbHViXCIgKyBjbHViSWQgKyBcIl1cIik7XG4gICAgICAgICAgICAgICAgc2hvd1RvQ2x1YkNoZWNrYm94LnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiVXRpbGl0aWVzLnRzXCIvPlxuXG5cbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cblxuY2xhc3MgUXVlc3Rpb24ge1xuXG4gICAgcHJpdmF0ZSBxdWVzdGlvbkRpdjogSlF1ZXJ5O1xuXG4gICAgY29uc3RydWN0b3IoZWxlbWVudDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMucXVlc3Rpb25EaXYgPSAkKGVsZW1lbnQpLmNsb3Nlc3QoJ1tuYW1lXj1xdWVzdGlvbl0nKTtcbiAgICB9XG59Il19
