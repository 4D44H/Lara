///<reference path="_references.ts"/>
$("#button-create-survey").click(function () {
    var errors = new Array();
    if ($("#description").val().length > 1500) {
        errors.push(translate("descriptionTooLong"));
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});

///<reference path="_references.ts"/>
function getRowName(a) {
    return $(a).children("td").eq(0).text();
}
function getRowShifts(a) {
    return $(a).children("td").eq(1).text();
}
//inspired by http://stackoverflow.com/questions/3160277/jquery-table-sort
function sortTable($table, byName, descending) {
    var rowCatcher = byName ? getRowName : getRowShifts;
    var rows = $table
        .find("tbody")
        .find("tr")
        .toArray()
        .sort(function (a, b) { return rowCatcher(a).localeCompare(rowCatcher(b), undefined, { 'numeric': true }); });
    if (descending) {
        rows.reverse();
    }
    rows.forEach(function (row) { return $table.append($(row)); });
}
function updateSortIconStyle($table, byName, descending) {
    // remove specific sorting from all icons
    $table.find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .removeClass('fa-sort-asc')
        .removeClass('fa-sort-desc')
        .addClass('fa-sort');
    // and add the current sorting order to the one that changed
    var icon = $table.find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .filter(function () {
        var sortIdentifier = byName ? 'name' : 'shifts';
        return $(this).parent().data('sort') === sortIdentifier;
    });
    icon.removeClass('fa-sort')
        .addClass(descending ? 'fa-sort-desc' : 'fa-sort-asc');
}
function sortLeaderboards(sortIcon) {
    var $tables = $('#memberStatisticsTabs').find('table');
    var wasAscending = sortIcon.hasClass('fa-sort-asc');
    var isNameSort = sortIcon.parent().data('sort') === 'name';
    localStorage.setItem('preferredSortType', isNameSort ? 'name' : 'shifts');
    localStorage.setItem('preferredSortOrder', wasAscending ? 'descending' : 'ascending');
    $tables.each(function () {
        sortTable($(this), isNameSort, wasAscending);
        updateSortIconStyle($(this), isNameSort, wasAscending);
    });
}
$(".fa-sort, .fa-sort-desc, .fa-sort-asc").click(function () {
    sortLeaderboards(this);
});
$('#memberStatisticsTabs').find('thead').find('td').click(function () {
    sortLeaderboards($($(this).find('i').first()));
});
$(".statisticClubPicker").find("a").click(function () {
    var clubName = $(this).text().trim();
    localStorage.setItem('preferredStatistics', clubName);
});
$(".leaderboardsClubPicker").find("a").click(function () {
    var leaderBoardName = $(this).text().trim();
    localStorage.setItem('preferredLeaderboards', leaderBoardName);
});
$(function () {
    var preferredStatistics = localStorage.getItem('preferredStatistics');
    if (preferredStatistics) {
        $('.statisticClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredStatistics;
        })
            .first()
            .click();
    }
    var preferredLeaderboards = localStorage.getItem('preferredLeaderboards');
    if (preferredLeaderboards) {
        $('.leaderboardsClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredLeaderboards;
        })
            .first()
            .click();
    }
    var preferredSortType = localStorage.getItem('preferredSortType');
    var preferredSortOrder = localStorage.getItem('preferredSortOrder');
    var $tables = $('#memberStatisticsTabs').find('table');
    var isNameSort = preferredSortType === 'name';
    var isDescending = preferredSortOrder === 'descending';
    $tables.each(function () {
        sortTable($(this), isNameSort, isDescending);
        updateSortIconStyle($(this), isNameSort, isDescending);
    });
});

///<reference path="_references.ts"/>
var Club;
(function (Club) {
    Club[Club["None"] = 0] = "None";
    Club[Club["BcClub"] = 2] = "BcClub";
    Club[Club["BcCafe"] = 3] = "BcCafe";
    Club[Club["BdClub"] = 4] = "BdClub";
    Club[Club["BhClub"] = 5] = "BhClub";
    Club[Club["BiClub"] = 6] = "BiClub";
})(Club || (Club = {}));
function getIdOfClub(club) {
    switch (club) {
        case "bc-Club":
            return Club.BcClub;
        case "bc-Caf√©":
            return Club.BcCafe;
    }
    return Club.None;
}
function showErrorModal(message) {
    $("#errorModal").modal("show");
    $("#errorModal").find(".modal-body").html(message);
}

// external references go here
///<reference path="../typings/index.d.ts"/>
///<reference path="CreateEditEvent.ts"/>
///<reference path="CreateSurvey.ts"/>
///<reference path="StatisticsView.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="_references.ts"/>
// values of events that should trigger the selection of all clubs
var internalEventValues = [
    "1",
    "4",
    "5",
    "6",
    "9" // other
];
$("#button-create-submit").add("#button-edit-submit").click(function () {
    var beginDate = new Date($("[name='beginDate']").prop("value") + " " + $("[name='beginTime']").prop("value"));
    var endDate = new Date($("[name='endDate']").prop("value") + " " + $("[name='endTime']").prop("value"));
    // contains the keys to translations to be shown if the condition is fulfilled
    var errorConditions = {
        'endBeforeStart': beginDate.getTime() > endDate.getTime(),
        'forgotFilter': $("#filter-checkboxes").find("input[type=checkbox]:checked").length === 0,
        'forgotPreparation': $('[name="preparationTime"]').val() === "",
        'forgotStartTime': $('[name="beginTime"]').val() === "",
        'forgotEndTime': $('[name="endTime"]').val() === ""
    };
    var errors = Object.keys(errorConditions)
        .filter(function (key) { return errorConditions[key]; })
        .map(function (key) { return translate(key); });
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});
$(function () {
    // if set, internal events will trigger selection of all clubs
    // if user sets the club manually, we want to keep his selection
    var autoSelectAllClubs = true;
    var allClubCheckBoxes = $("#filter").find("input[type=checkbox]");
    allClubCheckBoxes.click(function () {
        autoSelectAllClubs = false;
    });
    // important to use function() (anonymous function) here an not an arrow function
    // using an arrow function will change the "this" inside
    $("[name='evnt_type']").click(function () {
        var prop = $(this).val();
        var isInternalEvent = internalEventValues.indexOf(prop) !== -1;
        if (isInternalEvent) {
            if (autoSelectAllClubs) {
                $("#filter").find("input[type=checkbox]").prop("checked", true);
            }
        }
        else {
            // reset all checkboxes
            $("#filter").find("input[type=checkbox]").prop("checked", false);
            var clubName = $(document).find("#place").val();
            var clubId = getIdOfClub(clubName);
            if (clubId !== -1) {
                var showToClubCheckbox = $(document).find("[name=filterShowToClub" + clubId + "]");
                showToClubCheckbox.prop("checked", true);
            }
        }
    });
});

///<reference path="../typings/index.d.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="../typings/index.d.ts"/>
var Question = (function () {
    function Question(element) {
        this.questionDiv = $(element).closest('[name^=question]');
    }
    return Question;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZVN1cnZleS50cyIsIlN0YXRpc3RpY3NWaWV3LnRzIiwiVXRpbGl0aWVzLnRzIiwiX3JlZmVyZW5jZXMudHMiLCJDcmVhdGVFZGl0RXZlbnQudHMiLCJFdmVudFZpZXcudHMiLCJRdWVzdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7SUFFakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sR0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUssR0FBRyxHQUFHLEdBQUcsTUFBTSxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7O0FDWkgscUNBQXFDO0FBRXJDLG9CQUFvQixDQUFTO0lBQ3pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QyxDQUFDO0FBRUQsc0JBQXNCLENBQVM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMs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SyxDQUFDLENBQUM7WUFDakUsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNoRCxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkMsRUFBRSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEIsSUFBSSxrQkFBa0IsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLHdCQUF3QixHQUFHLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQztnQkFDbkYsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3QyxDQUFDO1FBQ0wsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7O0FDakVILDRDQUE0QztBQUM1QyxtQ0FBbUM7O0FDRG5DLDRDQUE0QztBQUU1QztJQUlJLGtCQUFZLE9BQWU7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUNMLGVBQUM7QUFBRCxDQVBBLEFBT0MsSUFBQSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCJfcmVmZXJlbmNlcy50c1wiLz5cblxuJChcIiNidXR0b24tY3JlYXRlLXN1cnZleVwiKS5jbGljaygoKSA9PiB7XG4gICAgbGV0IGVycm9ycyA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG5cbiAgICBpZiAoJChcIiNkZXNjcmlwdGlvblwiKS52YWwoKS5sZW5ndGggID4gMTUwMCkge1xuICAgICAgICBlcnJvcnMucHVzaCh0cmFuc2xhdGUoXCJkZXNjcmlwdGlvblRvb0xvbmdcIikpO1xuICAgIH1cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYm9vdGJveC5hbGVydChlcnJvcnMubWFwKGVyciA9PiBcIjxwPlwiICsgZXJyICsgXCI8L3A+XCIpLmpvaW4oXCJcXG5cIikpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG5cblxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XG5cbmZ1bmN0aW9uIGdldFJvd05hbWUoYTogc3RyaW5nKSB7XG4gICAgcmV0dXJuICQoYSkuY2hpbGRyZW4oXCJ0ZFwiKS5lcSgwKS50ZXh0KCk7XG59XG5cbmZ1bmN0aW9uIGdldFJvd1NoaWZ0cyhhOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gJChhKS5jaGlsZHJlbihcInRkXCIpLmVxKDEpLnRleHQoKTtcbn1cblxuXG4vL2luc3BpcmVkIGJ5IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzE2MDI3Ny9qcXVlcnktdGFibGUtc29ydFxuZnVuY3Rpb24gc29ydFRhYmxlKCR0YWJsZTogSlF1ZXJ5LCBieU5hbWU6IGJvb2xlYW4sIGRlc2NlbmRpbmc6IGJvb2xlYW4pIHtcbiAgICBsZXQgcm93Q2F0Y2hlciA9IGJ5TmFtZSA/IGdldFJvd05hbWUgOiBnZXRSb3dTaGlmdHM7XG4gICAgbGV0IHJvd3MgPSAkdGFibGVcbiAgICAgICAgLmZpbmQoXCJ0Ym9keVwiKVxuICAgICAgICAuZmluZChcInRyXCIpXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IHJvd0NhdGNoZXIoYSkubG9jYWxlQ29tcGFyZShyb3dDYXRjaGVyKGIpLCB1bmRlZmluZWQsIHsnbnVtZXJpYyc6IHRydWV9KSk7XG4gICAgaWYgKGRlc2NlbmRpbmcpIHtcbiAgICAgICAgcm93cy5yZXZlcnNlKCk7XG4gICAgfVxuICAgIHJvd3MuZm9yRWFjaChyb3cgPT4gJHRhYmxlLmFwcGVuZCgkKHJvdykpKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlU29ydEljb25TdHlsZSgkdGFibGU6IEpRdWVyeSwgYnlOYW1lOiBib29sZWFuLCBkZXNjZW5kaW5nOiBib29sZWFuKSB7XG4gICAgLy8gcmVtb3ZlIHNwZWNpZmljIHNvcnRpbmcgZnJvbSBhbGwgaWNvbnNcbiAgICAkdGFibGUuZmluZCgnLmZhLXNvcnQsIC5mYS1zb3J0LWRlc2MsIC5mYS1zb3J0LWFzYycpXG4gICAgICAgIC5yZW1vdmVDbGFzcygnZmEtc29ydC1hc2MnKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQtZGVzYycpXG4gICAgICAgIC5hZGRDbGFzcygnZmEtc29ydCcpO1xuICAgIC8vIGFuZCBhZGQgdGhlIGN1cnJlbnQgc29ydGluZyBvcmRlciB0byB0aGUgb25lIHRoYXQgY2hhbmdlZFxuICAgIGxldCBpY29uID0gJHRhYmxlLmZpbmQoJy5mYS1zb3J0LCAuZmEtc29ydC1kZXNjLCAuZmEtc29ydC1hc2MnKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxldCBzb3J0SWRlbnRpZmllciA9IGJ5TmFtZSA/ICduYW1lJyA6ICdzaGlmdHMnO1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcykucGFyZW50KCkuZGF0YSgnc29ydCcpID09PSBzb3J0SWRlbnRpZmllcjtcbiAgICAgICAgfSk7XG4gICAgaWNvbi5yZW1vdmVDbGFzcygnZmEtc29ydCcpXG4gICAgICAgIC5hZGRDbGFzcyhkZXNjZW5kaW5nID8gJ2ZhLXNvcnQtZGVzYycgOiAnZmEtc29ydC1hc2MnKTtcbn1cblxuZnVuY3Rpb24gc29ydExlYWRlcmJvYXJkcyhzb3J0SWNvbjogSlF1ZXJ5KSB7XG4gICAgbGV0ICR0YWJsZXMgPSAkKCcjbWVtYmVyU3RhdGlzdGljc1RhYnMnKS5maW5kKCd0YWJsZScpO1xuICAgIGxldCB3YXNBc2NlbmRpbmcgPSBzb3J0SWNvbi5oYXNDbGFzcygnZmEtc29ydC1hc2MnKTtcbiAgICBsZXQgaXNOYW1lU29ydCA9IHNvcnRJY29uLnBhcmVudCgpLmRhdGEoJ3NvcnQnKSA9PT0gJ25hbWUnO1xuXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcnJlZFNvcnRUeXBlJywgaXNOYW1lU29ydCA/ICduYW1lJyA6ICdzaGlmdHMnKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJlZmVycmVkU29ydE9yZGVyJywgd2FzQXNjZW5kaW5nID8gJ2Rlc2NlbmRpbmcnIDogJ2FzY2VuZGluZycpO1xuXG4gICAgJHRhYmxlcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgIHNvcnRUYWJsZSgkKHRoaXMpLCBpc05hbWVTb3J0LCB3YXNBc2NlbmRpbmcpO1xuICAgICAgICB1cGRhdGVTb3J0SWNvblN0eWxlKCQodGhpcyksIGlzTmFtZVNvcnQsIHdhc0FzY2VuZGluZyk7XG4gICAgfSk7XG59XG5cbiQoXCIuZmEtc29ydCwgLmZhLXNvcnQtZGVzYywgLmZhLXNvcnQtYXNjXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBzb3J0TGVhZGVyYm9hcmRzKHRoaXMpO1xufSk7XG5cbiQoJyNtZW1iZXJTdGF0aXN0aWNzVGFicycpLmZpbmQoJ3RoZWFkJykuZmluZCgndGQnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICBzb3J0TGVhZGVyYm9hcmRzKCQoJCh0aGlzKS5maW5kKCdpJykuZmlyc3QoKSkpO1xufSk7XG5cbiQoXCIuc3RhdGlzdGljQ2x1YlBpY2tlclwiKS5maW5kKFwiYVwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICBsZXQgY2x1Yk5hbWUgPSAkKHRoaXMpLnRleHQoKS50cmltKCk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcnJlZFN0YXRpc3RpY3MnLCBjbHViTmFtZSk7XG59KTtcblxuJChcIi5sZWFkZXJib2FyZHNDbHViUGlja2VyXCIpLmZpbmQoXCJhXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgIGxldCBsZWFkZXJCb2FyZE5hbWUgPSAkKHRoaXMpLnRleHQoKS50cmltKCk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcnJlZExlYWRlcmJvYXJkcycsIGxlYWRlckJvYXJkTmFtZSk7XG59KTtcblxuXG4kKCgpID0+IHtcbiAgICBsZXQgcHJlZmVycmVkU3RhdGlzdGljcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcmVmZXJyZWRTdGF0aXN0aWNzJyk7XG4gICAgaWYgKHByZWZlcnJlZFN0YXRpc3RpY3MpIHtcbiAgICAgICAgJCgnLnN0YXRpc3RpY0NsdWJQaWNrZXInKS5maW5kKCdhJykuZmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcykudGV4dCgpLnRyaW0oKSA9PT0gcHJlZmVycmVkU3RhdGlzdGljcztcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5maXJzdCgpXG4gICAgICAgICAgICAuY2xpY2soKTtcbiAgICB9XG5cbiAgICBsZXQgcHJlZmVycmVkTGVhZGVyYm9hcmRzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3ByZWZlcnJlZExlYWRlcmJvYXJkcycpO1xuICAgIGlmIChwcmVmZXJyZWRMZWFkZXJib2FyZHMpIHtcbiAgICAgICAgJCgnLmxlYWRlcmJvYXJkc0NsdWJQaWNrZXInKS5maW5kKCdhJykuZmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcykudGV4dCgpLnRyaW0oKSA9PT0gcHJlZmVycmVkTGVhZGVyYm9hcmRzO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmZpcnN0KClcbiAgICAgICAgICAgIC5jbGljaygpO1xuICAgIH1cblxuICAgIGxldCBwcmVmZXJyZWRTb3J0VHlwZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcmVmZXJyZWRTb3J0VHlwZScpO1xuICAgIGxldCBwcmVmZXJyZWRTb3J0T3JkZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJlZmVycmVkU29ydE9yZGVyJyk7XG5cbiAgICBsZXQgJHRhYmxlcyA9ICQoJyNtZW1iZXJTdGF0aXN0aWNzVGFicycpLmZpbmQoJ3RhYmxlJyk7XG4gICAgbGV0IGlzTmFtZVNvcnQgPSBwcmVmZXJyZWRTb3J0VHlwZSA9PT0gJ25hbWUnO1xuICAgIGxldCBpc0Rlc2NlbmRpbmcgPSBwcmVmZXJyZWRTb3J0T3JkZXIgPT09ICdkZXNjZW5kaW5nJztcblxuICAgICR0YWJsZXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgc29ydFRhYmxlKCQodGhpcyksIGlzTmFtZVNvcnQsIGlzRGVzY2VuZGluZyk7XG4gICAgICAgIHVwZGF0ZVNvcnRJY29uU3R5bGUoJCh0aGlzKSwgaXNOYW1lU29ydCwgaXNEZXNjZW5kaW5nKTtcbiAgICB9KVxuXG59KTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxuZW51bSBDbHViIHtcbiAgICBOb25lLFxuICAgIEJjQ2x1YiA9IDIsXG4gICAgQmNDYWZlLFxuICAgIEJkQ2x1YixcbiAgICBCaENsdWIsXG4gICAgQmlDbHViXG59XG5cbmZ1bmN0aW9uIGdldElkT2ZDbHViIChjbHViOiBzdHJpbmcpOiBDbHViIHtcbiAgICBzd2l0Y2ggKGNsdWIpIHtcbiAgICAgICAgY2FzZSBcImJjLUNsdWJcIjpcbiAgICAgICAgICAgIHJldHVybiBDbHViLkJjQ2x1YjtcbiAgICAgICAgY2FzZSBcImJjLUNhZsOpXCI6XG4gICAgICAgICAgICByZXR1cm4gQ2x1Yi5CY0NhZmU7XG4gICAgfVxuICAgIHJldHVybiBDbHViLk5vbmU7XG59XG5cbmZ1bmN0aW9uIHNob3dFcnJvck1vZGFsKG1lc3NhZ2U6IHN0cmluZykge1xuICAgICQoXCIjZXJyb3JNb2RhbFwiKS5tb2RhbChcInNob3dcIik7XG4gICAgJChcIiNlcnJvck1vZGFsXCIpLmZpbmQoXCIubW9kYWwtYm9keVwiKS5odG1sKG1lc3NhZ2UpO1xufVxuIiwiLy8gZXh0ZXJuYWwgcmVmZXJlbmNlcyBnbyBoZXJlXG4vLy88cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XG5cbi8vIGludGVybmFsIHJlZmVyZW5jZSBnbyBoZXJlXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJDcmVhdGVFZGl0RXZlbnQudHNcIi8+XG4vLy88cmVmZXJlbmNlIHBhdGg9XCJDcmVhdGVTdXJ2ZXkudHNcIi8+XG4vLy88cmVmZXJlbmNlIHBhdGg9XCJTdGF0aXN0aWNzVmlldy50c1wiLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIlV0aWxpdGllcy50c1wiLz5cblxuZGVjbGFyZSBsZXQgdHJhbnNsYXRlOiAoa2V5OiBzdHJpbmcpID0+IHN0cmluZztcblxuXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJfcmVmZXJlbmNlcy50c1wiLz5cblxuLy8gdmFsdWVzIG9mIGV2ZW50cyB0aGF0IHNob3VsZCB0cmlnZ2VyIHRoZSBzZWxlY3Rpb24gb2YgYWxsIGNsdWJzXG5sZXQgaW50ZXJuYWxFdmVudFZhbHVlcyA9IFtcbiAgICBcIjFcIiwgLy8gSW5mb1xuICAgIFwiNFwiLCAvLyBJbnRlcm5hbCBldmVudFxuICAgIFwiNVwiLCAvLyBwcml2YXRlIHBhcnR5XG4gICAgXCI2XCIsIC8vIGNsZWFuaW5nXG4gICAgXCI5XCIgIC8vIG90aGVyXG5dO1xuXG4kKFwiI2J1dHRvbi1jcmVhdGUtc3VibWl0XCIpLmFkZChcIiNidXR0b24tZWRpdC1zdWJtaXRcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuXG4gICAgbGV0IGJlZ2luRGF0ZSA9IG5ldyBEYXRlKCQoXCJbbmFtZT0nYmVnaW5EYXRlJ11cIikucHJvcChcInZhbHVlXCIpICsgXCIgXCIgKyAkKFwiW25hbWU9J2JlZ2luVGltZSddXCIpLnByb3AoXCJ2YWx1ZVwiKSk7XG4gICAgbGV0IGVuZERhdGUgPSBuZXcgRGF0ZSgkKFwiW25hbWU9J2VuZERhdGUnXVwiKS5wcm9wKFwidmFsdWVcIikgKyBcIiBcIiArICQoXCJbbmFtZT0nZW5kVGltZSddXCIpLnByb3AoXCJ2YWx1ZVwiKSk7XG5cbiAgICAvLyBjb250YWlucyB0aGUga2V5cyB0byB0cmFuc2xhdGlvbnMgdG8gYmUgc2hvd24gaWYgdGhlIGNvbmRpdGlvbiBpcyBmdWxmaWxsZWRcbiAgICBsZXQgZXJyb3JDb25kaXRpb25zOiB7W2tleTogc3RyaW5nXTogYm9vbGVhbn0gPSB7XG4gICAgICAgICdlbmRCZWZvcmVTdGFydCc6IGJlZ2luRGF0ZS5nZXRUaW1lKCkgPiBlbmREYXRlLmdldFRpbWUoKSxcbiAgICAgICAgJ2ZvcmdvdEZpbHRlcic6ICQoXCIjZmlsdGVyLWNoZWNrYm94ZXNcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdOmNoZWNrZWRcIikubGVuZ3RoID09PSAwLFxuICAgICAgICAnZm9yZ290UHJlcGFyYXRpb24nOiAkKCdbbmFtZT1cInByZXBhcmF0aW9uVGltZVwiXScpLnZhbCgpID09PSBcIlwiLFxuICAgICAgICAnZm9yZ290U3RhcnRUaW1lJzogJCgnW25hbWU9XCJiZWdpblRpbWVcIl0nKS52YWwoKSA9PT0gXCJcIixcbiAgICAgICAgJ2ZvcmdvdEVuZFRpbWUnOiAkKCdbbmFtZT1cImVuZFRpbWVcIl0nKS52YWwoKSA9PT0gXCJcIlxuICAgIH07XG5cbiAgICBsZXQgZXJyb3JzID0gT2JqZWN0LmtleXMoZXJyb3JDb25kaXRpb25zKVxuICAgICAgICAuZmlsdGVyKGtleSA9PiBlcnJvckNvbmRpdGlvbnNba2V5XSlcbiAgICAgICAgLm1hcChrZXkgPT4gdHJhbnNsYXRlKGtleSkpO1xuXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGJvb3Rib3guYWxlcnQoZXJyb3JzLm1hcChlcnIgPT4gXCI8cD5cIiArIGVyciArIFwiPC9wPlwiKS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn0pO1xuJCgoKSA9PiB7XG4gICAgLy8gaWYgc2V0LCBpbnRlcm5hbCBldmVudHMgd2lsbCB0cmlnZ2VyIHNlbGVjdGlvbiBvZiBhbGwgY2x1YnNcbiAgICAvLyBpZiB1c2VyIHNldHMgdGhlIGNsdWIgbWFudWFsbHksIHdlIHdhbnQgdG8ga2VlcCBoaXMgc2VsZWN0aW9uXG4gICAgbGV0IGF1dG9TZWxlY3RBbGxDbHVicyA9IHRydWU7XG4gICAgbGV0IGFsbENsdWJDaGVja0JveGVzID0gJChcIiNmaWx0ZXJcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpO1xuICAgIGFsbENsdWJDaGVja0JveGVzLmNsaWNrKCgpID0+IHtcbiAgICAgICAgYXV0b1NlbGVjdEFsbENsdWJzID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICAvLyBpbXBvcnRhbnQgdG8gdXNlIGZ1bmN0aW9uKCkgKGFub255bW91cyBmdW5jdGlvbikgaGVyZSBhbiBub3QgYW4gYXJyb3cgZnVuY3Rpb25cbiAgICAvLyB1c2luZyBhbiBhcnJvdyBmdW5jdGlvbiB3aWxsIGNoYW5nZSB0aGUgXCJ0aGlzXCIgaW5zaWRlXG4gICAgJChcIltuYW1lPSdldm50X3R5cGUnXVwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBwcm9wID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgbGV0IGlzSW50ZXJuYWxFdmVudCA9IGludGVybmFsRXZlbnRWYWx1ZXMuaW5kZXhPZihwcm9wKSAhPT0gLTE7XG4gICAgICAgIGlmIChpc0ludGVybmFsRXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChhdXRvU2VsZWN0QWxsQ2x1YnMpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyByZXNldCBhbGwgY2hlY2tib3hlc1xuICAgICAgICAgICAgJChcIiNmaWx0ZXJcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpLnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIGxldCBjbHViTmFtZSA9ICQoZG9jdW1lbnQpLmZpbmQoXCIjcGxhY2VcIikudmFsKCk7XG4gICAgICAgICAgICBsZXQgY2x1YklkID0gZ2V0SWRPZkNsdWIoY2x1Yk5hbWUpO1xuXG4gICAgICAgICAgICBpZiAoY2x1YklkICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIGxldCBzaG93VG9DbHViQ2hlY2tib3ggPSAkKGRvY3VtZW50KS5maW5kKFwiW25hbWU9ZmlsdGVyU2hvd1RvQ2x1YlwiICsgY2x1YklkICsgXCJdXCIpO1xuICAgICAgICAgICAgICAgIHNob3dUb0NsdWJDaGVja2JveC5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG5cbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIlV0aWxpdGllcy50c1wiLz5cblxuXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XG5cbmNsYXNzIFF1ZXN0aW9uIHtcblxuICAgIHByaXZhdGUgcXVlc3Rpb25EaXY6IEpRdWVyeTtcblxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnF1ZXN0aW9uRGl2ID0gJChlbGVtZW50KS5jbG9zZXN0KCdbbmFtZV49cXVlc3Rpb25dJyk7XG4gICAgfVxufSJdfQ==
